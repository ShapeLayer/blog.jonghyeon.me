---
layout: post
title: 사용자 정의 가능한 iptables의 체인 이름
date: '2023-01-08'
categories: [linux, software]
tags: [linux, software, tool]
---

리눅스의 iptables에 익숙하지 않은 사용자는 리눅스 위에서 서버를 여는 과정에서 의아한 경험을 종종 핮니다. 분명 리눅스 로컬, localhost로 잘 접속되는 서버가 외부에서는 접근할 수 없습니다.

그리고 이 문제를 해결하기 위해 이것 저것 검색하면 곧 방화벽 설정이 문제라는 것을 깨닫습니다. 어쩌면 이 문제를 여러번 겪으면서도 여러번 똑같이 검색하면서 일련의 명령어 패턴을 외울 정도가 되었을지도 모르겠습니다.

```bash
# 마인크래프트 서버의 디폴트 포트 방화벽 설정
iptables -A INPUT -p tcp --dport 25563 -j ACCEPT
```

많은 사람들이 iptables를 “귀납적”으로 학습하며 iptables 명령의 일정한 패턴을 각자 나름대로 외우게 됩니다.

## iptables의 체인

`-A INPUT` `-A OUTPUT` 명령으로 대두되는 “체인에 정책 추가” 옵션은 바로 이 휴리스틱한 암기의 대표적인 예시입니다.

분명 `-s`와 `-d`, `--sport`와 `--dport`같이 명령 옵션에는 인/아웃바운드 옵션이 분리되어 있는데도 `-A INPUT` `-A OUTPUT`를 잘못 입력하거나 추가하지 않으면 큰일이 일어날것만 같습니다.

하지만 큰일은 일어나지 않습니다.

체인은 생각보다 느슨한 시스템입니다. INPUT과 OUTPUT은 그 자체로 특별한 시스템이 있는 것이 아니라 체인의 이름일 뿐입니다. 그리고 체인은 방화벽 정책들의 리스트입니다.

INPUT과 OUTPUT이 그 자체로는 특별한 역할이 있는 것이 아니므로 사용자가 체인 이름을 자체적으로 정의해도 문제가 발생하지 않을 것입니다. 실제로 아래 명령은 오류가 발생하지 않습니다.

```bash
iptables -A AIMLESS -p tcp --dport 25563 -j ACCEPT
```

이 명령이 오류가 발생하지 않긴 하지만, 방화벽 설정은 실질적으로 변경되지 않습니다. iptables는 INPUT, OUTPUT과 같은 내장 기본 체인만 실행합니다. 사용자 정의 체인은 내장 기본 체인에 연결하지 않으면 작동하지 않습니다.
